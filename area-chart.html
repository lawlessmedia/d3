<!DOCTYPE html>
<!--
	http://www.d3noob.org/2014/07/my-favourite-tooltip-method-for-line.html
  
  http://www.mattlayman.com/2015/d3js-area-chart.html
	https://leanpub.com/D3-Tips-and-Tricks/
	http://www.d3noob.org/2013/01/smoothing-out-lines-in-d3js.html
	
	vertical path - http://bl.ocks.org/WillTurman/4631136
-->
<meta charset="utf-8">
<style>

body {
  background: #efefef;
  font: 10px sans-serif;
  margin:0;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.line {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}
.area {
  fill: steelblue;
  /*stroke: #000;
  stroke-width: 2px;*/
}
.area:hover {
  fill: #ccc;
}
.label {
  font-size: 2em;
  fill: #fff;
  text-anchor: end;
  shape-rendering: crispEdges;
}
#area {
  position: absolute;
  bottom: 0;
}

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(255, 255, 255, 0.6);
  color: steelblue;
  border-radius: 2px;
}

.d3-tip-value {
  color: #666;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(255, 255, 255, 0.6);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
</style>
<body>
	<div class="tidechart">
		<svg id="area" />
	</div>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<!--
	03:21 AM	4.67
09:41 AM	-0.07
03:38 PM	3.49
09:35 PM	-0.51
04:22 AM	4.85
10:43 AM	-0.2
04:40 PM	3.52
10:33 PM	-0.57
-->
<script>

//var parseDate = d3.time.format("%m/%d/%y %I:%M %p");
var parseDate = d3.time.format("%Y-%m-%d %H:%M");

/*
var data = [
    { x: "01/20/16 03:58 AM", y: "4.14" },
    { x: "01/20/16 10:33 AM", y: "-0.49" },
    { x: "01/20/16 04:20 PM", y: "3.36" },
    { x: "01/20/16 10:33 PM", y: "-0.87" }
];
*/

var data = [ {"x":"2016-01-20 00:00", "y":"0.837"},{"x":"2016-01-20 00:06", "y":"0.744"},{"x":"2016-01-20 00:12", "y":"0.652"},{"x":"2016-01-20 00:18", "y":"0.560"},{"x":"2016-01-20 00:24", "y":"0.470"},{"x":"2016-01-20 00:30", "y":"0.380"},{"x":"2016-01-20 00:36", "y":"0.292"},{"x":"2016-01-20 00:42", "y":"0.205"},{"x":"2016-01-20 00:48", "y":"0.121"},{"x":"2016-01-20 00:54", "y":"0.038"},{"x":"2016-01-20 01:00", "y":"-0.043"},{"x":"2016-01-20 01:06", "y":"-0.121"},{"x":"2016-01-20 01:12", "y":"-0.196"},{"x":"2016-01-20 01:18", "y":"-0.269"},{"x":"2016-01-20 01:24", "y":"-0.338"},{"x":"2016-01-20 01:30", "y":"-0.403"},{"x":"2016-01-20 01:36", "y":"-0.464"},{"x":"2016-01-20 01:42", "y":"-0.521"},{"x":"2016-01-20 01:48", "y":"-0.573"},{"x":"2016-01-20 01:54", "y":"-0.621"},{"x":"2016-01-20 02:00", "y":"-0.663"},{"x":"2016-01-20 02:06", "y":"-0.700"},{"x":"2016-01-20 02:12", "y":"-0.732"},{"x":"2016-01-20 02:18", "y":"-0.757"},{"x":"2016-01-20 02:24", "y":"-0.777"},{"x":"2016-01-20 02:30", "y":"-0.790"},{"x":"2016-01-20 02:36", "y":"-0.797"},{"x":"2016-01-20 02:42", "y":"-0.798"},{"x":"2016-01-20 02:48", "y":"-0.792"},{"x":"2016-01-20 02:54", "y":"-0.779"},{"x":"2016-01-20 03:00", "y":"-0.760"},{"x":"2016-01-20 03:06", "y":"-0.734"},{"x":"2016-01-20 03:12", "y":"-0.701"},{"x":"2016-01-20 03:18", "y":"-0.662"},{"x":"2016-01-20 03:24", "y":"-0.617"},{"x":"2016-01-20 03:30", "y":"-0.565"},{"x":"2016-01-20 03:36", "y":"-0.507"},{"x":"2016-01-20 03:42", "y":"-0.443"},{"x":"2016-01-20 03:48", "y":"-0.373"},{"x":"2016-01-20 03:54", "y":"-0.298"},{"x":"2016-01-20 04:00", "y":"-0.218"},{"x":"2016-01-20 04:06", "y":"-0.132"},{"x":"2016-01-20 04:12", "y":"-0.042"},{"x":"2016-01-20 04:18", "y":"0.052"},{"x":"2016-01-20 04:24", "y":"0.150"},{"x":"2016-01-20 04:30", "y":"0.253"},{"x":"2016-01-20 04:36", "y":"0.358"},{"x":"2016-01-20 04:42", "y":"0.467"},{"x":"2016-01-20 04:48", "y":"0.578"},{"x":"2016-01-20 04:54", "y":"0.692"},{"x":"2016-01-20 05:00", "y":"0.808"},{"x":"2016-01-20 05:06", "y":"0.925"},{"x":"2016-01-20 05:12", "y":"1.044"},{"x":"2016-01-20 05:18", "y":"1.165"},{"x":"2016-01-20 05:24", "y":"1.285"},{"x":"2016-01-20 05:30", "y":"1.407"},{"x":"2016-01-20 05:36", "y":"1.529"},{"x":"2016-01-20 05:42", "y":"1.650"},{"x":"2016-01-20 05:48", "y":"1.772"},{"x":"2016-01-20 05:54", "y":"1.892"},{"x":"2016-01-20 06:00", "y":"2.012"},{"x":"2016-01-20 06:06", "y":"2.131"},{"x":"2016-01-20 06:12", "y":"2.249"},{"x":"2016-01-20 06:18", "y":"2.365"},{"x":"2016-01-20 06:24", "y":"2.479"},{"x":"2016-01-20 06:30", "y":"2.591"},{"x":"2016-01-20 06:36", "y":"2.700"},{"x":"2016-01-20 06:42", "y":"2.808"},{"x":"2016-01-20 06:48", "y":"2.912"},{"x":"2016-01-20 06:54", "y":"3.014"},{"x":"2016-01-20 07:00", "y":"3.112"},{"x":"2016-01-20 07:06", "y":"3.207"},{"x":"2016-01-20 07:12", "y":"3.299"},{"x":"2016-01-20 07:18", "y":"3.387"},{"x":"2016-01-20 07:24", "y":"3.470"},{"x":"2016-01-20 07:30", "y":"3.550"},{"x":"2016-01-20 07:36", "y":"3.625"},{"x":"2016-01-20 07:42", "y":"3.696"},{"x":"2016-01-20 07:48", "y":"3.762"},{"x":"2016-01-20 07:54", "y":"3.823"},{"x":"2016-01-20 08:00", "y":"3.879"},{"x":"2016-01-20 08:06", "y":"3.930"},{"x":"2016-01-20 08:12", "y":"3.976"},{"x":"2016-01-20 08:18", "y":"4.016"},{"x":"2016-01-20 08:24", "y":"4.051"},{"x":"2016-01-20 08:30", "y":"4.080"},{"x":"2016-01-20 08:36", "y":"4.104"},{"x":"2016-01-20 08:42", "y":"4.122"},{"x":"2016-01-20 08:48", "y":"4.134"},{"x":"2016-01-20 08:54", "y":"4.141"},{"x":"2016-01-20 09:00", "y":"4.142"},{"x":"2016-01-20 09:06", "y":"4.138"},{"x":"2016-01-20 09:12", "y":"4.128"},{"x":"2016-01-20 09:18", "y":"4.112"},{"x":"2016-01-20 09:24", "y":"4.092"},{"x":"2016-01-20 09:30", "y":"4.066"},{"x":"2016-01-20 09:36", "y":"4.035"},{"x":"2016-01-20 09:42", "y":"3.999"},{"x":"2016-01-20 09:48", "y":"3.958"},{"x":"2016-01-20 09:54", "y":"3.913"},{"x":"2016-01-20 10:00", "y":"3.864"},{"x":"2016-01-20 10:06", "y":"3.810"},{"x":"2016-01-20 10:12", "y":"3.752"},{"x":"2016-01-20 10:18", "y":"3.691"},{"x":"2016-01-20 10:24", "y":"3.626"},{"x":"2016-01-20 10:30", "y":"3.557"},{"x":"2016-01-20 10:36", "y":"3.485"},{"x":"2016-01-20 10:42", "y":"3.411"},{"x":"2016-01-20 10:48", "y":"3.333"},{"x":"2016-01-20 10:54", "y":"3.253"},{"x":"2016-01-20 11:00", "y":"3.170"},{"x":"2016-01-20 11:06", "y":"3.085"},{"x":"2016-01-20 11:12", "y":"2.997"},{"x":"2016-01-20 11:18", "y":"2.908"},{"x":"2016-01-20 11:24", "y":"2.817"},{"x":"2016-01-20 11:30", "y":"2.723"},{"x":"2016-01-20 11:36", "y":"2.629"},{"x":"2016-01-20 11:42", "y":"2.532"},{"x":"2016-01-20 11:48", "y":"2.435"},{"x":"2016-01-20 11:54", "y":"2.336"},{"x":"2016-01-20 12:00", "y":"2.236"},{"x":"2016-01-20 12:06", "y":"2.134"},{"x":"2016-01-20 12:12", "y":"2.032"},{"x":"2016-01-20 12:18", "y":"1.929"},{"x":"2016-01-20 12:24", "y":"1.825"},{"x":"2016-01-20 12:30", "y":"1.721"},{"x":"2016-01-20 12:36", "y":"1.617"},{"x":"2016-01-20 12:42", "y":"1.512"},{"x":"2016-01-20 12:48", "y":"1.407"},{"x":"2016-01-20 12:54", "y":"1.302"},{"x":"2016-01-20 13:00", "y":"1.198"},{"x":"2016-01-20 13:06", "y":"1.094"},{"x":"2016-01-20 13:12", "y":"0.991"},{"x":"2016-01-20 13:18", "y":"0.890"},{"x":"2016-01-20 13:24", "y":"0.789"},{"x":"2016-01-20 13:30", "y":"0.691"},{"x":"2016-01-20 13:36", "y":"0.594"},{"x":"2016-01-20 13:42", "y":"0.499"},{"x":"2016-01-20 13:48", "y":"0.407"},{"x":"2016-01-20 13:54", "y":"0.318"},{"x":"2016-01-20 14:00", "y":"0.232"},{"x":"2016-01-20 14:06", "y":"0.150"},{"x":"2016-01-20 14:12", "y":"0.071"},{"x":"2016-01-20 14:18", "y":"-0.003"},{"x":"2016-01-20 14:24", "y":"-0.073"},{"x":"2016-01-20 14:30", "y":"-0.139"},{"x":"2016-01-20 14:36", "y":"-0.199"},{"x":"2016-01-20 14:42", "y":"-0.254"},{"x":"2016-01-20 14:48", "y":"-0.304"},{"x":"2016-01-20 14:54", "y":"-0.348"},{"x":"2016-01-20 15:00", "y":"-0.386"},{"x":"2016-01-20 15:06", "y":"-0.418"},{"x":"2016-01-20 15:12", "y":"-0.444"},{"x":"2016-01-20 15:18", "y":"-0.463"},{"x":"2016-01-20 15:24", "y":"-0.477"},{"x":"2016-01-20 15:30", "y":"-0.483"},{"x":"2016-01-20 15:36", "y":"-0.484"},{"x":"2016-01-20 15:42", "y":"-0.478"},{"x":"2016-01-20 15:48", "y":"-0.465"},{"x":"2016-01-20 15:54", "y":"-0.447"},{"x":"2016-01-20 16:00", "y":"-0.422"},{"x":"2016-01-20 16:06", "y":"-0.391"},{"x":"2016-01-20 16:12", "y":"-0.354"},{"x":"2016-01-20 16:18", "y":"-0.312"},{"x":"2016-01-20 16:24", "y":"-0.264"},{"x":"2016-01-20 16:30", "y":"-0.210"},{"x":"2016-01-20 16:36", "y":"-0.152"},{"x":"2016-01-20 16:42", "y":"-0.089"},{"x":"2016-01-20 16:48", "y":"-0.021"},{"x":"2016-01-20 16:54", "y":"0.051"},{"x":"2016-01-20 17:00", "y":"0.126"},{"x":"2016-01-20 17:06", "y":"0.206"},{"x":"2016-01-20 17:12", "y":"0.289"},{"x":"2016-01-20 17:18", "y":"0.375"},{"x":"2016-01-20 17:24", "y":"0.464"},{"x":"2016-01-20 17:30", "y":"0.555"},{"x":"2016-01-20 17:36", "y":"0.649"},{"x":"2016-01-20 17:42", "y":"0.744"},{"x":"2016-01-20 17:48", "y":"0.841"},{"x":"2016-01-20 17:54", "y":"0.940"},{"x":"2016-01-20 18:00", "y":"1.040"},{"x":"2016-01-20 18:06", "y":"1.141"},{"x":"2016-01-20 18:12", "y":"1.242"},{"x":"2016-01-20 18:18", "y":"1.344"},{"x":"2016-01-20 18:24", "y":"1.446"},{"x":"2016-01-20 18:30", "y":"1.547"},{"x":"2016-01-20 18:36", "y":"1.649"},{"x":"2016-01-20 18:42", "y":"1.749"},{"x":"2016-01-20 18:48", "y":"1.849"},{"x":"2016-01-20 18:54", "y":"1.948"},{"x":"2016-01-20 19:00", "y":"2.045"},{"x":"2016-01-20 19:06", "y":"2.141"},{"x":"2016-01-20 19:12", "y":"2.235"},{"x":"2016-01-20 19:18", "y":"2.327"},{"x":"2016-01-20 19:24", "y":"2.416"},{"x":"2016-01-20 19:30", "y":"2.503"},{"x":"2016-01-20 19:36", "y":"2.587"},{"x":"2016-01-20 19:42", "y":"2.668"},{"x":"2016-01-20 19:48", "y":"2.745"},{"x":"2016-01-20 19:54", "y":"2.819"},{"x":"2016-01-20 20:00", "y":"2.890"},{"x":"2016-01-20 20:06", "y":"2.956"},{"x":"2016-01-20 20:12", "y":"3.018"},{"x":"2016-01-20 20:18", "y":"3.075"},{"x":"2016-01-20 20:24", "y":"3.128"},{"x":"2016-01-20 20:30", "y":"3.176"},{"x":"2016-01-20 20:36", "y":"3.218"},{"x":"2016-01-20 20:42", "y":"3.256"},{"x":"2016-01-20 20:48", "y":"3.288"},{"x":"2016-01-20 20:54", "y":"3.315"},{"x":"2016-01-20 21:00", "y":"3.337"},{"x":"2016-01-20 21:06", "y":"3.352"},{"x":"2016-01-20 21:12", "y":"3.362"},{"x":"2016-01-20 21:18", "y":"3.367"},{"x":"2016-01-20 21:24", "y":"3.365"},{"x":"2016-01-20 21:30", "y":"3.358"},{"x":"2016-01-20 21:36", "y":"3.345"},{"x":"2016-01-20 21:42", "y":"3.327"},{"x":"2016-01-20 21:48", "y":"3.303"},{"x":"2016-01-20 21:54", "y":"3.274"},{"x":"2016-01-20 22:00", "y":"3.239"},{"x":"2016-01-20 22:06", "y":"3.200"},{"x":"2016-01-20 22:12", "y":"3.155"},{"x":"2016-01-20 22:18", "y":"3.106"},{"x":"2016-01-20 22:24", "y":"3.052"},{"x":"2016-01-20 22:30", "y":"2.994"},{"x":"2016-01-20 22:36", "y":"2.931"},{"x":"2016-01-20 22:42", "y":"2.865"},{"x":"2016-01-20 22:48", "y":"2.795"},{"x":"2016-01-20 22:54", "y":"2.722"},{"x":"2016-01-20 23:00", "y":"2.645"},{"x":"2016-01-20 23:06", "y":"2.565"},{"x":"2016-01-20 23:12", "y":"2.483"},{"x":"2016-01-20 23:18", "y":"2.398"},{"x":"2016-01-20 23:24", "y":"2.310"},{"x":"2016-01-20 23:30", "y":"2.221"},{"x":"2016-01-20 23:36", "y":"2.129"},{"x":"2016-01-20 23:42", "y":"2.036"},{"x":"2016-01-20 23:48", "y":"1.942"},{"x":"2016-01-20 23:54", "y":"1.846"} ];


var margin = {top: 0, right: 20, bottom: 50, left: 50},
    width = document.body.clientWidth - (margin.left + margin.right),
    //width = 600,
    height = 200;

var x = d3.time.scale()
    .domain(d3.extent(data, function(d) { 
	    return parseDate.parse(d.x); }))
    .range([0, width]);

//var x = d3.scale.linear()
//    .domain([0, d3.max(data, function(d) { return d.x; })])
//    .range([0, width]);

var y = d3.scale.linear()
    .domain([-5, d3.max(data, function(d) { return d.y; })])
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var bisectDate = d3.bisector(function(d) { return x(parseDate.parse(d.x)) }).left;

// var tip = d3.tip()
//   .attr('class', 'd3-tip')
//   .offset([0, 0])
//   .html(function(d) {
//     console.log(d);
//     return "<strong>Time:</strong> <span class='d3-tip-value'>" + bisectDate + "</span>";
// });
  
var area = d3.svg.area()
	.interpolate("cardinal")
    .x(function(d) { return x(parseDate.parse(d.x)); })
    .y0(height)
    .y1(function(d) { return y(d.y); });

var svg = d3.select("svg#area")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.append("path")
    .datum(data)
    .attr("class", "area")
    .attr("d", area);
    //.on('mouseover', tip.show)
    //.on('mouseout', tip.hide);

svg.append("text")
  .attr("x", width - 20)
  .attr("y", height - 20)
  .attr("class", "label")
  .text(function(symbol) { return 'Revenue'; });

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);

var lineSvg = svg.append("g");

var focus = svg.append("g")
    .style("display", "none");

// append the circle at the intersection                   // **********
    focus.append("circle")                                 // **********
        .attr("class", "y")                                // **********
        .style("fill", "none")                             // **********
        .style("stroke", "black")                          // **********
        .attr("r", 4);                                     // **********
    
    // append the rectangle to capture mouse               // **********
    svg.append("rect")                                     // **********
        .attr("width", width)                              // **********
        .attr("height", height)                            // **********
        .style("fill", "none")                             // **********
        .style("pointer-events", "all")                    // **********
        .on("mouseover", function() { focus.style("display", null); })
        .on("mouseout", function() { focus.style("display", "none"); })
        .on("mousemove", mousemove);                       // **********

    function mousemove() {                                 // **********
        var x0 = x.invert(d3.mouse(this)[0]),              // **********
            xpos = console.log(d3.mouse(this)[0]);
            ypos = console.log(d3.mouse(this)[1]);
            //xvalue = console.log(x.d3.mouse(this)[0]);
            xvalue = console.log(x.invert(d3.mouse(this)[0]));
            i = bisectDate(data, x0, 1),
            l = console.log('i: ' + i),                  // **********
            d0 = data[i - 1],                              // **********
            d1 = data[i];                                  // **********
            //d = x0 - d0.x > d1.x - x0 ? d1 : d0;

            console.log(d0);            // **********
            console.log('d1: ' + d1);

        // focus.select("circle.y")                           // **********
        //     .attr("transform",                             // **********
        //           "translate(" + x(d.x) + "," +         // **********
        //                          y(d.y) + ")");            // **********
    }  

//svg.call(tip);


</script>